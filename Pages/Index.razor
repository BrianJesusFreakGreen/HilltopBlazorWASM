@page "/"
@inject HttpClient Http
@using System.Net.Http;
@using System.Web;
@using System.Net.Http.Json;
@using System.Threading.Tasks;
@using Microsoft.Extensions.Configuration;
@using Models;
@inject IConfiguration Configuration
@inject NavigationManager UriHelper


@if (allPosts == null)
{
   // <p style="color:white;background-color: red;position:absolute;"><em>Having issue communicating with server....Try again later or contact webmaster@hilltopaog.org</em></p>
     
}
else
{
    
    <PageTitle>Index</PageTitle>
    <EventBlock ButtonLink="event"></EventBlock>
    //Look this up in Doc...how to use...spitting html from strapi
    //Microsoft.AspNetCore.Components.MarkupString()
} <!--delete closing and uncomment closing at bottom to reinstate-->
    <section class="above-fold d-flex justify-content-center">
        <div class="bg-haze">
        
            <div class="cta z1 text-center">
                <titlecase>Love God. Love People. Pass It On.</titlecase>
                <div class="cta-video-container">
                    <div class="cta-video @CTAStreamCSSClass">
                        <iframe width="100%" src="https://www.youtube.com/embed/live_stream?channel=UCDZkIokEkrAHYiVUw4KqRxw" frameborder="0" allowfullscreen autplay></iframe>
                    </div>
                </div>
                <!--<div class="inverse-btn">
                    <button class="btn btn-white text-uppercase" onclick="location.href='/post/TestTitle'" type="button">New Here?</button>
                </div>-->
                <div class="inverse-btn">
                    <button class="btn btn-stream text-uppercase" @onclick="ToggleCTAStream" type="button">
                        Live Stream
                    </button>
                </div>
                <div class="info-flag">
                    <div class="info-flag-pole"></div>
                <div class="info-flag-banner">
                        <div class="bg-haze-fill"></div>
                        <div style="position:relative;z-index:1;">
                            <h2>Sundays<br />10:00 AM</h2>
                            <p>30 North Cranberry Road</p>
                            <p>Westminster, MD 21258</p>  <!-- Replace with CMS Address later.  Will need 2 line entries on CMS 
                                                            Address: Line 1 and Address: Line 2 for API Call in a 'General Info' Content Type-->
                        </div>
                    </div>
                </div>
                 
            </div>
        </div>
        
    </section>
    <section class="section1">
        <div class="container-lg px-0">
            <div class="row text-center">
                <div class="col-md-4 p-md-4">
                    <div class="promo-box info">
                        <h2>Biblical Sermons</h2>
                        <p>Sermons rooted in scripture and relevant to life.  Pastor Rod brings the word to life to teach, rebuke, correct and train in righteousness.</p>
                    </div>
                    <div class="promo-box-cta"></div>
                </div>
                <div class="col-md-4 p-md-4">
                    <div class="promo-box-card info">
                        <h2>Give Boldly</h2>
                        <p>Sermons rooted in scripture and relevant to life.  Pastor Rod brings the word to life to teach, rebuke, correct and train in righteousness.</p>
                        <div class="promo-box-cta">
                            <button class="btn btn-white text-uppercase border border-2 border-primary m-4" @onclick=@Navigate>Give Now</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 p-md-4">
                    <div class="promo-box info">
                        <h2>Biblical Sermons</h2>
                        <p>Sermons rooted in scripture and relevant to life.  Pastor Rod brings the word to life to teach, rebuke, correct and train in righteousness.</p>
                    </div>
                    <div class="promo-box-cta"></div>
                </div>

        </div>
        </div>

    </section>
    <section class="section2">
        <div class="px-0">
            <div class="row text-center p-0">
                <div class="col-md-8 p-0">
                    <div class="offset-card align-items-center">
                        <div class="offset-card-insert">
                            <h4>Our Mission & Vision</h4>
                            <h3>Love God. Love People. Pass It On.</h3>
                            <p>We’re here to glorify God by living out the Greatest Commandment (Matthew 22:37-39) and fulfilling the Great Commission (Mark 16:15-20).</p>
                            <button class="btn btn-white text-uppercase border border-2 border-primary m-4" @onclick=@Navigate>Learn More</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 p-0">
                    <div class="feature-card">
                        <div class="feature-card-feature">
                        <iframe title="HILLTOP ASSEMBLY OF GOD LIVE BROADCAST: Sermon – What Can Stand In the Way? (February 28, 2021)" width="100%" scrolling="yes" src=""
                                srcDoc="<style>*{padding:0;margin:0;overflow:hidden}html,body{height:100%}img,span{position:absolute;width:100%;top:0;bottom:0;margin:auto}span{height:1.5em;text-align:center;font:48px/1.5 sans-serif;color:white;text-shadow:0 0 0.5em black}</style><a href=https://www.youtube.com/embed/S_vUPvuoznQ?autoplay=1><img src=https://img.youtube.com/vi/S_vUPvuoznQ/hqdefault.jpg alt='Video The Dark Knight Rises: What Went Wrong? – Wisecrack Edition'><span>▶</span></a>"
                                frameBorder="0" allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowFullScreen name="fitvid0" loading="lazy"></iframe>
                    </div>
                        <div class="feature-card-info">
                            <h2>Latest Service</h2>
                            <hr />
                            <p>Missed last week?  Catch up on announcement, sermons and worship right here!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="section3">
        <div class="px-0">
            <div class="row d-flex justify-content-center text-center p-0">
                <div class="col-md-6">
                    <div class="">
                        <h1>This is some filler text HardCoded, not CMS.</h1>
                        <p>Don't mind me I'm just helping my master design a web app.  I am just here to push down a little bit of white space.</p>
                        <p>perhaps he needs more.  There is another paragraph to help add space.</p>
                        <p>More you say?  Why soitently.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <div class="container">
       
                <div class="row align-items-start">
                    <div class="col-lg-8 m-15px-tb">
                        <div class="row">
                            <div class="col-sm-6">
                                @if(allPosts != null){
                                    foreach (var post in allPosts.data)
                                {
                                <div class="blog-grid">
                                    <div class="blog-img">
                                        <div class="date">
                                            <span>04</span>
                                            <label>FEB</label>
                                        </div>
                                        <a href="#">
                                            <img src="https://via.placeholder.com/400x200/FFB6C1/000000" title="" alt="">
                                        </a>
                                    </div>
                                    <div class="blog-info">
                                        <h5><a href="/post/@post.attributes.Title">@post.attributes.Title</a></h5>
                                        <p>@post.attributes.Content</p>
                                        <div class="btn-bar">
                                            <a href="#" class="px-btn-arrow">
                                                <span>Read More</span>
                                                <i class="arrow"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                }}
                            </div>
                            </div>
                    </div>
                </div>
            
        
    </div>
    
@code {
    private bool collapseCTAStream;
    private string? CTAStreamCSSClass => collapseCTAStream ? null : "hidden";
    Posts? allPosts;
    string myJson;
    public string strapi_api_url;

    protected override async Task OnInitializedAsync()
    {
        strapi_api_url = Configuration["AppSettings:STRAPI_API_URL"];
        //var url = "{STRAPI_API_URL}/api/posts";
        //url = url.Replace("{STRAPI_API_URL}", strapi_api_url);
        string url = "https://blazor.eternalharvestfarm.com/api/posts";
        Console.WriteLine("API call to: " + url);
        
        allPosts = await Http.GetFromJsonAsync<Posts>(url);

        /*
        * 
        if (allPosts != null && allPosts.Length > 0)
            {
                foreach (var post in allPosts)
                {
                //post.Image.Url = strapi_a && allPosts.Datas.Length > 0pi_url + post.Image.Url;

        }
    }

    */
    }
    void Navigate(){
        UriHelper.NavigateTo("Event/Thing");
    }

    private void ToggleCTAStream(){
        collapseCTAStream = !collapseCTAStream;
    }
}
